<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


    <style>
        body{
            margin: 0;
            font-family: sans-serif;
            text-align: center;

            background-color: #222;
            overflow: hidden;
        }

        iframe{
            height:100vh;
        }

    </style>


</head>
<body>
    <div className='Dev'>
        <iframe id='iframe' src='http://localhost:3000?view=editor'></iframe>
    </div>

    <script>
        const iframe = document.getElementById('iframe')

        let pageData = undefined

        // send data to iframe        
        function sendMsg(type, data, element){
            const msg = {type:type, data:data}
            console.log('sending msg to iframe:', msg)
            element.contentWindow.postMessage(msg, '*') 
        }

        function handleMsg(msg){
            console.log('msg from iframe:', msg.data)
            const {type, data} = msg.data
            
            // init data
            const editorData = {
                type:'editor', 
                data:{ blocks:[] }
            }

            const viewerData = {
                type:'viewer', 
                data:{ blocks:[] }
            }

            const tocData = {
                type:'toc', 
                data: {
                    selected: [1,'unit 1',1],
                    pages: {
                        0: {
                            'unit 1': [1,2,3,4,5],
                            'unit 2': [1,2,3,4],
                            'unit 3': [1,2,3,4,5,6,7],
                        },
                        1: {
                            'unit 1': [1,2,3,4,5],
                            'unit 2': [1,2,3,4],
                            'unit 3': [1,2,3,4,5,6,7],
                        },
                        2: {
                            'unit 1': [1,2,3,4,5],
                            'unit 2': [1,2,3,4],
                            'unit 3': [1,2,3,4,5,6,7],
                        }
                    }
                }
            }

            const x = {
                    pages: {
                        0: {
                            'unit 1': [1,2,3,4,5],
                            'unit 2': [1,2,3,4],
                            'unit 3': [1,2,3,4,5,6,7],
                        }
                    }}

            if (type === 'hello'){
                pageData = tocData.data
                sendMsg('init', tocData, iframe)
            }

            if (type === 'update') {

                console.log('\n\nOldPageData:', pageData)

                pageData = {...pageData, ...data}
                console.log('\t\tData:',data)

                console.log('\n\nNewPageData:', pageData)
                sendMsg('update', pageData, iframe)
            }
            
            
            //console.log('new data:', pageData)

            

            /*if (msg.data){
                if ('blockUpdate' in msg.data){
                    console.log('neat')
                    blocks = msg.data.blockUpdate.blocks
                    sendMsg({'blocks':blocks}, viewer)
                }
            }*/
        }

        window.addEventListener('message', (msg) => handleMsg(msg))

    </script>
</body>
</html>